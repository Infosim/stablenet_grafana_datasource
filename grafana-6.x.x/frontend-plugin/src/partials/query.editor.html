<!--
  ~ Copyright: Infosim GmbH & Co. KG Copyright (c) 2000-2020
  ~ Company: Infosim GmbH & Co. KG,
  ~                  Landsteinerstraße 4,
  ~                  97074 Wuerzburg, Germany
  ~                  www.infosim.net
  -->
<query-editor-row query-ctrl="ctrl"
                  class="generic-datasource-query-row"
                  has-text-edit-mode="false"
>

    <div class="gf-form-inline">
        <div class="gf-form">
            <label class="gf-form-label query-keyword width-11">
                Query Mode:
                <info-popover mode="right-normal">Allows switching between Measurement mode and Statistic Link mode.</info-popover>
            </label>
            <gf-form-dropdown model="ctrl.target.mode"
                              allow-custom="true"
                              lookup-text="true"
                              get-options="ctrl.getModes()"
                              class="width-10"
                              tabindex="0"
                              on-change="ctrl.onModeChange()"
            >
            </gf-form-dropdown>
        </div>
    </div>

    <div ng-if="ctrl.target.mode===0">

        <div class="gf-form-inline">
            <div class="gf-form">
                <label class="gf-form-label query-keyword width-11">
                    Device Filter:
                    <info-popover mode="right-normal">The dropdown menu on the right will only show devices containing
                        the string typed into this field. Case insensitive.
                    </info-popover>
                </label>
                <input class="gf-form-input width-19"
                       type="text"
                       ng-model="ctrl.target.deviceQuery"
                       ng-blur="ctrl.onDeviceQueryChange()"
                       tabindex="0"
                >
            </div>
            <div class="gf-form">
                <label class="gf-form-label query-keyword width-11">
                    Device:
                </label>
                <gf-form-dropdown model="ctrl.target.selectedDevice"
                                  allow-custom="true"
                                  lookup-text="true"
                                  get-options="ctrl.getDevices()"
                                  on-change="ctrl.onDeviceChange()"
                                  class="min-width-19"
                                  tabindex="0"
                >
                </gf-form-dropdown>
            </div>
            <div ng-if="ctrl.target.moreDevices"
                 class="gf-form"
            >
                <label class="gf-form-label width-2">
                    <info-popover mode="right-normal">There are more devices available, but only the first 100 are displayed. 
                        Specify a stricter Device Filter to reduce the number of shown devices.
                    </info-popover> 
                </label>
            </div>
            <div class="gf-form gf-form--grow">
                <div class="gf-form-label gf-form-label--grow"></div>
            </div>
        </div>

        <div class="gf-form-inline">
            <div class="gf-form">
                <label class="gf-form-label query-keyword width-11">
                    Measurement Filter:
                    <info-popover mode="right-normal">The dropdown menu on the right will only show measurements containing
                        the string typed into this field. Case insensitive.
                    </info-popover>
                </label>
                <input class="gf-form-input width-19"
                       type="text"
                       ng-model="ctrl.target.measurementQuery"
                       ng-blur="ctrl.onMeasurementRegexChange()"
                       tabindex="0"
                >
            </div>
            <div class="gf-form">
                <label class="gf-form-label query-keyword width-11">
                    Measurement:
                </label>
                <gf-form-dropdown model="ctrl.target.selectedMeasurement"
                                  allow-custom="true"
                                  lookup-text="true"
                                  get-options="ctrl.getMeasurements()"
                                  on-change="ctrl.onMeasurementChange()"
                                  class="width-19"
                                  tabindex="0"
                >
                </gf-form-dropdown>
            </div>
            <div ng-if="ctrl.target.moreMeasurements"
                 class="gf-form"
            >
                <label class="gf-form-label width-2">
                    <info-popover mode="right-normal">There are more measurements available, but only the first 100 are displayed. 
                        Use the Measurement Filter for higher accuracy.
                    </info-popover> 
                </label>
            </div>
            <div class="gf-form gf-form--grow">
                <div class="gf-form-label gf-form-label--grow"></div>
            </div>
        </div>

        <div ng-if="ctrl.target.selectedMeasurement">            
            <div class="gf-form"
                 ng-if="!ctrl.target.metrics.length"
            >
                <label class="gf-form-label query-keyword width-30 sn-indented-label" style="padding-left: 150px;">No metrics available!</label>
            </div>

            <div class="gf-form"
                 style="margin-bottom: 0px!important"
            >
                <div class="gf-form"
                     style="margin-bottom: 0px!important"
                >
                    <label class="gf-form-label query-keyword width-11">
                        Metric Prefix:
                        <info-popover mode="right-normal">
                            The input of this field will be added as a prefix to the metrics' names on the chart.
                        </info-popover>
                    </label>
                    <input class="gf-form-input width-19"
                           type="text"
                           ng-model="ctrl.target.metricPrefix"
                           ng-blur="ctrl.onChangeInternal()"
                           tabindex="0"
                    >
                </div>
                <label class="gf-form-label query-keyword width-11 sn-unindented-label"
                       ng-if="ctrl.target.metrics.length"
                >Metrics:
                    <info-popover mode="right-normal">Select the metrics you want to display.</info-popover>
                </label>
                <div class="gf-form-inline">
                    <div class="gf-form"
                         ng-repeat="metric in ctrl.target.metrics"
                         style="margin-bottom: 0px!important"
                    >
                        <gf-form-checkbox class="gf-form sn-checkbox-width"
                                          checked="ctrl.target.chosenMetrics[metric.key]"
                                          on-change="ctrl.onChangeInternal()"
                                          tabindex="0"
                        >
                        </gf-form-checkbox>
                        <label class="gf-form-label query-keyword sn-single-metric-label">{{ metric.text }}</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="ctrl.target.mode===10">
        <div class="gf-form-inline">
            <div class="gf-form gf-form--grow">
                <label class="gf-form-label query-keyword width-11">
                    Link:
                    <info-popover mode="right-normal">Copy a link from the StableNet®-Analyzer. Experimental: At the current version, only links containing exactly one measurement are supported.</info-popover>
                </label>
                <input class="gf-form-input"
                       type="text"
                       ng-model="ctrl.target.statisticLink"
                       spellcheck="false"
                       ng-blur="ctrl.onChangeInternal()"
                       tabindex="0"
                >
            </div>
        </div>
    </div>

    <div class="gf-form-group"
         ng-if="ctrl.target.selectedMeasurement || (ctrl.target.mode === 10)"
    >
        <label ng-class="(ctrl.target.mode === 0) ? 'gf-form-label query-keyword width-11 sn-indented-label' : 'gf-form-label query-keyword width-11 sn-unindented-label'">
            Include Statistics:
            <info-popover mode="right-normal">Select the statistics you want to display.</info-popover>
        </label>
        <div class="gf-form-inline">
                <gf-form-checkbox class="gf-form sn-checkbox-width"
                                  checked="ctrl.target.includeMinStats"
                                  on-change="ctrl.onChangeInternal()"
                                  tabindex="0"
                >
                </gf-form-checkbox>
                <label class="gf-form-label query-keyword"
                       style="width: 56px!important"
                >Min
                </label>
                <gf-form-checkbox class="gf-form sn-checkbox-width"
                                  checked="ctrl.target.includeAvgStats"
                                  on-change="ctrl.onChangeInternal()"
                                  tabindex="0"
                >
                </gf-form-checkbox>
                <label class="gf-form-label query-keyword"
                       style="width: 56px!important"
                >Avg
                </label>
                <gf-form-checkbox class="gf-form sn-checkbox-width"
                                  checked="ctrl.target.includeMaxStats"
                                  on-change="ctrl.onChangeInternal()"
                                  tabindex="0"
                >
                </gf-form-checkbox>
                <label class="gf-form-label query-keyword"
                       style="width: 56px!important"
                >Max
                </label>
        </div>

        <div class="gf-form-inline">
            <div class="gf-form" style="margin-left: 3px">
                <gf-form-checkbox class="gf-form sn-checkbox-width"
                                  checked="ctrl.target.useCustomAverage"
                                  on-change="ctrl.onChangeInternal()"
                                  tabindex="0"
                >
                </gf-form-checkbox>
            </div>
            <label class="gf-form-label query-keyword width-11">
                Average Period:
                <info-popover mode="right-normal">Allows defining a custom average period in seconds. If disabled, Grafana will automatically compute a suiting average period.</info-popover>
            </label>
            <input class="gf-form-input width-10"
                   type="text"
                   ng-model="ctrl.target.averagePeriod"
                   ng-blur="ctrl.onDeviceQueryChange()"
                   tabindex="0"
                   ng-disabled="!ctrl.target.useCustomAverage"
            >
            <div class="gf-form">
                <gf-form-dropdown model="ctrl.target.averageUnit"
                                  allow-custom="true"
                                  lookup-text="true"
                                  get-options="ctrl.getUnits()"
                                  class="width-7"
                                  tabindex="0"
                                  on-change="ctrl.onChangeInternal()"
                >
                </gf-form-dropdown>
            </div>
        </div>
    </div>

</query-editor-row>
